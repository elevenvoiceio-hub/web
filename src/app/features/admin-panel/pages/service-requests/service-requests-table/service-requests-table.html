<div class="container mx-auto px-4 sm:px-8">
  <div class="py-8">
    <div class="my-2 flex sm:flex-row flex-col">
      <div
        class="flex flex-row mb-1 sm:mb-0 justify-between w-full overflow-auto gap-2"
      >
        <div class="flex gap-2">
          <brn-select class="inline-block" placeholder="Category" [(value)]="selectedCategory">
            <hlm-select-trigger class="w-56">
              <hlm-select-value />
            </hlm-select-trigger>
            <hlm-select-content>
              <hlm-option value="">All</hlm-option>
              @for(category of CATEGORY_CHOICES; track category.label ){
              <hlm-option [value]="category.value">{{category.label}}</hlm-option>
              }
            </hlm-select-content>
          </brn-select>
          <brn-select class="inline-block" placeholder="Priority" [(value)]="selectedPriority">
            <hlm-select-trigger class="w-56">
              <hlm-select-value />
            </hlm-select-trigger>
            <hlm-select-content>
              <hlm-option value="">All</hlm-option>
              @for(priority of PRIORITY_CHOICES; track priority.label ){
              <hlm-option [value]="priority.value">{{priority.label}}</hlm-option>
              }
            </hlm-select-content>
          </brn-select>
          <brn-select class="inline-block" placeholder="Status" [(value)]="selectedStatus">
            <hlm-select-trigger class="w-56">
              <hlm-select-value />
            </hlm-select-trigger>
            <hlm-select-content>
              <hlm-option value="">All</hlm-option>
              @for(choice of STATUS_CHOICES; track choice.label ){
              <hlm-option [value]="choice.value">{{choice.label}}</hlm-option>
              }
            </hlm-select-content>
          </brn-select>

          <div class="mr-2 w-full">
            <div class="relative inline-block w-full">
              <span
                class="text-muted-foreground absolute left-3 top-1/4 transform"
              >
                <ng-icon name="lucideSearch" />
              </span>
              <input
                type="text"
                placeholder="Search"
                [(ngModel)]="searchText"
                hlmInput
                class="bg-muted w-full pl-8"
                (change)="updateTable(selectedCategory(), selectedPriority(), selectedStatus(), searchText)"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="-mx-4 sm:-mx-8 px-4 sm:px-8 py-4 overflow-x-auto">
      <div class="inline-block min-w-full shadow rounded-lg overflow-hidden">
        <table>
          <thead>
            <tr>
              <th>Created by</th>
              <th>Subject</th>
              <th>Category</th>
              <th>Created on</th>
              <th>Priority</th>
              <th>Status</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            @for(request of displayData(); track request.created_by){
            <tr>
              <td>{{request.created_by}}</td>
              <td>{{request.subject | slice:0:50}}</td>
              <td>{{findCategoryLabel( request.category)}}</td>
              <td>
                {{request.created_on | date : 'medium'}}
              </td>
              <td>{{findPriorityLabel( request.priority)}}</td>
              <td>{{findStatusLabel( request.status)}}</td>
              <td>
                <div class="flex gap-2">
                   <button hlmBtn variant="ghost" class="px-2!" (click)="openEditDialog(request)">
                    <ng-icon name="remixPencilFill" />
                  </button>
                  <button hlmBtn variant="ghost" class="px-2! text-destructive!" (click)="deleteRequest(request.ticket_id)">
                    <ng-icon name="lucideTrash2" />
                  </button>
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>
        <app-pagination
          [(data)]="filteredRequests"
          [(page)]="pageNumber"
          [(rowsPerPage)]="rowsPerPage"
        />
      </div>
    </div>
  </div>
</div>
